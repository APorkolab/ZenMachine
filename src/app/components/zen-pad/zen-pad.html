<div class="container">
  <mat-card class="visualizer-card">
    <mat-card-content>
      <app-preset-manager></app-preset-manager>
    </mat-card-content>
  </mat-card>

  <mat-card class="visualizer-card">
    <mat-card-content>
      <app-visualizer *ngIf="isBrowser"></app-visualizer>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Sound Selection</mat-card-title>
    </mat-card-header>

    <button mat-raised-button (click)="enableAudio()">Hang engedélyezése</button>

    <mat-card-content class="sound-selector">
      <mat-form-field>
        <mat-label>Select a Sound</mat-label>
        <mat-select
          name="selectedSoundPath"
          [ngModelOptions]="{ standalone: true }"
          [(ngModel)]="selectedSoundPath"
        >
          @for (sound of sounds; track sound.path) {
            <mat-option [value]="sound.path">{{ sound.name }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <button mat-fab color="primary" (click)="addSound()">
        <mat-icon>add</mat-icon>
      </button>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Active Sounds</mat-card-title>
    </mat-card-header>

    <mat-card-content cdkDropList class="active-sounds" (cdkDropListDropped)="drop($event)">
      @for (sound of activeSounds$ | async; track sound.id) {
        <div class="active-sound" cdkDrag>
          <mat-icon cdkDragHandle>drag_handle</mat-icon>

          <mat-slider [min]="0" [max]="1" [step]="0.01">
            <input
              matSliderThumb
              [name]="'vol_' + sound.id"
              [ngModelOptions]="{ standalone: true }"
              [ngModel]="sound.volume"
              (ngModelChange)="audioService.setVolume(sound.id, $event)"
            />
          </mat-slider>

          <button mat-icon-button color="warn" (click)="stopSound(sound.id)">
            <mat-icon>stop</mat-icon>
          </button>
        </div>
      }
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Master Controls</mat-card-title>
    </mat-card-header>

    <mat-card-content class="controls">
      <div class="slider-container">
        <mat-slider [min]="0" [max]="1" [step]="0.01">
          <input
            matSliderThumb
            name="masterVolume"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="(masterVolume$ | async) ?? 0"
            (ngModelChange)="setMasterVolume($event)"
          />
        </mat-slider>
      </div>

      <div class="slider-container">
        <mat-slider [min]="-1" [max]="1" [step]="0.1">
          <input
            matSliderThumb
            name="pan"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="(pan$ | async) ?? 0"
            (ngModelChange)="setPan($event)"
          />
        </mat-slider>
      </div>

      <div class="slider-container">
        <label>Playback Rate</label>
        <mat-slider [min]="0.5" [max]="2" [step]="0.1">
          <input
            matSliderThumb
            name="playbackRate"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="playbackRate"
            (ngModelChange)="playbackRate = $event; audioService.setPlaybackRate($event)"
          />
        </mat-slider>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Equalizer</mat-card-title>
    </mat-card-header>

    <mat-card-content class="controls">
      <div class="slider-container">
        <mat-slider [min]="-10" [max]="10" [step]="0.1">
          <input
            matSliderThumb
            name="bass"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="(bass$ | async) ?? 0"
            (ngModelChange)="setBass($event)"
          />
        </mat-slider>
      </div>

      <div class="slider-container">
        <mat-slider [min]="-10" [max]="10" [step]="0.1">
          <input
            matSliderThumb
            name="mid"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="(mid$ | async) ?? 0"
            (ngModelChange)="setMid($event)"
          />
        </mat-slider>
      </div>

      <div class="slider-container">
        <mat-slider [min]="-10" [max]="10" [step]="0.1">
          <input
            matSliderThumb
            name="treble"
            [ngModelOptions]="{ standalone: true }"
            [ngModel]="(treble$ | async) ?? 0"
            (ngModelChange)="setTreble($event)"
          />
        </mat-slider>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Advanced Controls</mat-card-title>
    </mat-card-header>

    <mat-card-content class="advanced-controls">
      <div class="timer-alarm">
        <mat-form-field>
          <mat-label>Timer (minutes)</mat-label>
          <input
            matInput
            type="number"
            name="timer"
            [ngModelOptions]="{ standalone: true }"
            [(ngModel)]="timerValue"
          />
        </mat-form-field>
        <button mat-raised-button (click)="setTimer()">Set Timer</button>

        <mat-form-field>
          <mat-label>Alarm</mat-label>
          <input
            matInput
            type="time"
            name="alarm"
            [ngModelOptions]="{ standalone: true }"
            [(ngModel)]="alarmTime"
          />
        </mat-form-field>
        <button mat-raised-button (click)="setAlarm()">Set Alarm</button>
      </div>

      <div class="other-controls">
        <button mat-raised-button (click)="saveSettings()">Save Settings</button>
        <button mat-raised-button (click)="loadSettings()">Load Settings</button>
        <button mat-raised-button (click)="randomizeSettings()">Randomize Settings</button>
        <button mat-raised-button (click)="randomizeSound()">Add Random Sound</button>
        <button mat-raised-button color="warn" (click)="stopAllSounds()">Stop All Sounds</button>
        <button mat-raised-button (click)="toggleLoop()">
          Loop: {{ isLooping ? 'On' : 'Off' }}
        </button>

        <mat-slide-toggle
          name="darkMode"
          [ngModelOptions]="{ standalone: true }"
          [(ngModel)]="isDarkMode"
          (change)="toggleDarkMode()"
        >
          Dark Mode
        </mat-slide-toggle>

        <mat-form-field>
          <mat-label>Background</mat-label>
          <mat-select
            name="selectedBackground"
            [ngModelOptions]="{ standalone: true }"
            [(ngModel)]="selectedBackground"
            (selectionChange)="changeBackground()"
          >
            @for (bg of backgrounds; track bg.path) {
              <mat-option [value]="bg.path">{{ bg.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>
</div>
